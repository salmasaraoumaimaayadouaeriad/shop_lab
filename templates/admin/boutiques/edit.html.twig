{% extends 'admin/base.html.twig' %}

{% block title %}Modifier Boutique - Admin ShopLab{% endblock %}

{% block admin_content %}
<div class="container-fluid">
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">
            <i class="fas fa-store"></i> Modifier Boutique
        </h1>
        <a href="{{ path('admin_boutiques') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Retour
        </a>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Informations de la boutique</h6>
                </div>
                <div class="card-body">
                                         <form method="POST">
                         <input type="hidden" name="_token" value="{{ csrf_token('admin_boutique_form') }}">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="nom" class="form-label">Nom de la boutique *</label>
                                    <input type="text" class="form-control" id="nom" name="nom" 
                                           value="{{ boutique.nom }}" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="slug" class="form-label">Slug</label>
                                    <input type="text" class="form-control" id="slug" name="slug" 
                                           value="{{ boutique.slug }}" readonly>
                                    <div class="form-text">Le slug est généré automatiquement</div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <textarea class="form-control" id="description" name="description" rows="4">{{ boutique.description }}</textarea>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="niche" class="form-label">Niche</label>
                                    <select class="form-control" id="niche" name="niche">
                                        <option value="">Sélectionner une niche</option>
                                        <option value="electronics" {{ boutique.niche == 'electronics' ? 'selected' : '' }}>Électronique</option>
                                        <option value="fashion" {{ boutique.niche == 'fashion' ? 'selected' : '' }}>Mode</option>
                                        <option value="home" {{ boutique.niche == 'home' ? 'selected' : '' }}>Maison & Jardin</option>
                                        <option value="sports" {{ boutique.niche == 'sports' ? 'selected' : '' }}>Sport & Loisirs</option>
                                        <option value="beauty" {{ boutique.niche == 'beauty' ? 'selected' : '' }}>Beauté & Santé</option>
                                        <option value="books" {{ boutique.niche == 'books' ? 'selected' : '' }}>Livres & Éducation</option>
                                        <option value="food" {{ boutique.niche == 'food' ? 'selected' : '' }}>Alimentation</option>
                                        <option value="automotive" {{ boutique.niche == 'automotive' ? 'selected' : '' }}>Automobile</option>
                                        <option value="other" {{ boutique.niche == 'other' ? 'selected' : '' }}>Autre</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="statut" class="form-label">Statut</label>
                                    <select class="form-control" id="statut" name="statut">
                                        <option value="actif" {{ boutique.statut == 'actif' ? 'selected' : '' }}>Actif</option>
                                        <option value="inactif" {{ boutique.statut == 'inactif' ? 'selected' : '' }}>Inactif</option>
                                        <option value="suspendu" {{ boutique.statut == 'suspendu' ? 'selected' : '' }}>Suspendu</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                                                 <div class="row">
                             <div class="col-md-6">
                                 <div class="mb-3">
                                     <label for="url" class="form-label">URL</label>
                                     <input type="url" class="form-control" id="url" name="url" 
                                            value="{{ boutique.url }}">
                                 </div>
                             </div>
                             <div class="col-md-6">
                                 <div class="mb-3">
                                     <label for="domainePersonnalise" class="form-label">Domaine personnalisé</label>
                                     <input type="text" class="form-control" id="domainePersonnalise" name="domainePersonnalise" 
                                            value="{{ boutique.domainePersonnalise }}">
                                 </div>
                             </div>
                         </div>

                         <div class="mb-3">
                             <label for="template" class="form-label">Template</label>
                             <input type="text" class="form-control" id="template" name="template" 
                                    value="{{ boutique.template }}">
                         </div>

                        <div class="d-flex justify-content-between">
                            <a href="{{ path('admin_boutiques') }}" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Annuler
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Enregistrer
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <!-- Boutique Info -->
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Informations</h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <strong>Date de création:</strong><br>
                        <span class="text-muted">{{ boutique.dateCreation|date('d/m/Y H:i') }}</span>
                    </div>
                                         <div class="mb-3">
                         <strong>Commerçant:</strong><br>
                         <span class="text-muted">
                             {% if boutique.commercant %}
                                 {{ boutique.commercant.utilisateur.nom }}
                             {% else %}
                                 Non assigné
                             {% endif %}
                         </span>
                     </div>
                     <div class="mb-3">
                         <strong>Visites:</strong><br>
                         <span class="text-muted">{{ boutique.visites }} visite(s)</span>
                     </div>
                     <div class="mb-3">
                         <strong>URL:</strong><br>
                         <span class="text-muted">{{ boutique.url ?: 'Non définie' }}</span>
                     </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Actions rapides</h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{{ path('admin_boutique_show', {id: boutique.id}) }}" class="btn btn-info btn-sm">
                            <i class="fas fa-eye"></i> Voir détails
                        </a>
                        <button type="button" class="btn btn-warning btn-sm" onclick="toggleBoutiqueStatus()">
                            <i class="fas fa-toggle-on"></i> Changer statut
                        </button>
                        <button type="button" class="btn btn-danger btn-sm" onclick="deleteBoutique()">
                            <i class="fas fa-trash"></i> Supprimer
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function toggleBoutiqueStatus() {
    if (confirm('Êtes-vous sûr de vouloir changer le statut de cette boutique ?')) {
        fetch('{{ path('admin_boutique_toggle_status', {id: boutique.id}) }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Erreur: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Une erreur est survenue');
        });
    }
}

function deleteBoutique() {
    if (confirm('Êtes-vous sûr de vouloir supprimer cette boutique ? Cette action est irréversible.')) {
        fetch('{{ path('admin_boutique_delete', {id: boutique.id}) }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                window.location.href = '{{ path('admin_boutiques') }}';
            } else {
                alert('Erreur: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Une erreur est survenue');
        });
    }
}
</script>
{% endblock %} 